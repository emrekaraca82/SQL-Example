1)CREATE PROCEDURE SP_CARD_CONTROL
@WORKERBARCODE NVARCHAR(50)
AS
BEGIN
	IF EXISTS(SELECT * FROM WORKER WHERE WORKERBARCODE = @WORKERBARCODE)
		BEGIN
			SELECT 'KART DOGRU'
		END
	ELSE
		BEGIN
			SELECT 'KART GECERSÝZ'
		END
	
END

EXEC SP_CARD_CONTROL @WORKERBARCODE ='15594CCE-02AB-47FF-B70D-0F78820F1D09'

2)
CREATE PROCEDURE SP_CARD_CONTROL2
@WORKERBARCODE NVARCHAR(50)
AS
BEGIN
	DECLARE @WORKERNAME AS NVARCHAR(50) 
	SELECT @WORKERNAME = WORKNAME FROM WORKER WHERE WORKERBARCODE = @WORKERBARCODE
	IF @WORKERNAME IS NULL
		BEGIN
			SELECT 'KART GECERSÝZ'
		END
	ELSE
		BEGIN
			SELECT @WORKERNAME
		END
END

EXEC SP_CARD_CONTROL2 @WORKERBARCODE ='15594CDE-02AB-47FF-B70D-0F78820F1D09'

3)
CREATE PROC SP_WORKER_INOUT
@WORKERBARCODE AS VARCHAR(50),
@DATE AS DATETIME,
@IOTYPE AS VARCHAR(1),
@GATEID AS INT
AS
BEGIN

DECLARE @WORKERNAME AS NVARCHAR(100)
DECLARE @WORKERID AS INT
SELECT @WORKERNAME=WORKNAME,@WORKERID=ID FROM WORKER
WHERE WORKERBARCODE=@WORKERBARCODE

	IF @WORKERID IS NULL
	BEGIN
		RAISERROR('OKUTULAN KART GECERSÝZ',16,1)
		RETURN
	END

	DECLARE @LASTIO NVARCHAR(1)

	SELECT TOP 1 @LASTIO = IOTYPE FROM WORKERTRANSACTIONS
	WHERE WORKERID=1 AND DATE_ >=CONVERT(DATE,GETDATE())
	ORDER BY DATE_ DESC

	IF @LASTIO = @IOTYPE
	BEGIN
		IF @IOTYPE = 'G'
		BEGIN
			RAISERROR('ZATEN ÝCERÝDE GÖRÜNÜYORSUNUZ',16,1)
			RETURN
		END

		IF @IOTYPE = 'C'
		BEGIN
			RAISERROR('ZATEN DISARIDA GÖRÜNÜYORSUNUZ',16,1)
			RETURN
		END
	END

	INSERT INTO WORKERTRANSACTIONS(WORKERID,DATE_,IOTYPE,GATEID)
	VALUES(@WORKERID,@DATE,@IOTYPE,@GATEID)

	SELECT @WORKERNAME AS WORKERNAME ,@DATE AS DATE_, @IOTYPE AS IOTYPE FROM WORKERTRANSACTIONS

END
